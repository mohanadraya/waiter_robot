from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, filters, ContextTypes, ConversationHandler
from telegram import KeyboardButton
# Ø§Ù„Ù…Ø±Ø§Ø­Ù„
SELECT_MEAL, SELECT_TABLE = range(2)

meals = ["ğŸ” Ø¨Ø±Ø¬Ø±", "ğŸ• Ø¨ÙŠØªØ²Ø§", "ğŸ¥— Ø³Ù„Ø·Ø©"]
tables = ["1", "2", "3", "4", "5", "6"]

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    reply_markup = ReplyKeyboardMarkup([[m] for m in meals], one_time_keyboard=True, resize_keyboard=True)
    await update.message.reply_text("Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù…Ø·Ø¹Ù…Ù†Ø§! Ø§Ø®ØªØ± ÙˆØ¬Ø¨ØªÙƒ:", reply_markup=reply_markup)
    return SELECT_MEAL

async def select_meal(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data["meal"] = update.message.text
    reply_markup = ReplyKeyboardMarkup([[t] for t in tables], one_time_keyboard=True, resize_keyboard=True)
    await update.message.reply_text("Ø¬Ù…ÙŠÙ„! Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø·Ø§ÙˆÙ„ØªÙƒ:", reply_markup=reply_markup)
    return SELECT_TABLE

async def select_table(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data["table"] = update.message.text
    meal = context.user_data["meal"]
    table = context.user_data["table"]
    print("Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©", table)

    await update.message.reply_text(f"âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ: {meal} Ù„Ø·Ø§ÙˆÙ„Ø© Ø±Ù‚Ù… {table}. Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ!")

    # Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø²Ø± /start Ø¨Ø¹Ø¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
    reply_markup = ReplyKeyboardMarkup([[KeyboardButton("/start")]], resize_keyboard=True)
    await update.message.reply_text("Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¢Ø®Ø±ØŸ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ /start ğŸ‘‡", reply_markup=reply_markup)

async def cancel(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨.")
    return ConversationHandler.END

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
app = ApplicationBuilder().token("8140327281:AAFIpnPVZuTQfHSLZUMQg_wwf1apBFioNfs").build()

conv_handler = ConversationHandler(
    entry_points=[CommandHandler("start", start)],
    states={
        SELECT_MEAL: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_meal)],
        SELECT_TABLE: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_table)],
    },
    fallbacks=[CommandHandler("cancel", cancel)],
)

app.add_handler(conv_handler)

app.run_polling()
